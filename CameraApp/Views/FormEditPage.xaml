<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="CameraApp.Views.FormEditPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:CameraApp.ViewModels"
             xmlns:services="clr-namespace:CameraApp.Services"
             x:DataType="viewmodels:FormEditViewModel"
             Title="{Binding PageTitle}">

    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"/>
    </Shell.BackButtonBehavior>

    <ScrollView>
        <StackLayout Padding="20"
                Spacing="20">

            <!-- Header -->
            <Border BackgroundColor="{StaticResource Primary}"
                    Padding="20"
                    StrokeShape="RoundRectangle 10">
                <StackLayout BackgroundColor="{StaticResource Primary}"
                        Padding="20">
                    <Label Text="{Binding PageTitle}"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center"/>
                    <Label Text="{Binding [FormEdit_Subtitle], Source={x:Static services:LocalizationResourceManager.Instance}}"
                           FontSize="14"
                           TextColor="White"
                           HorizontalOptions="Center"
                           Margin="0,5,0,0"/>
                </StackLayout>
            </Border>

            <!-- Título -->
            <StackLayout BackgroundColor="White"
                    Padding="15">
                <Label Text="{Binding [FormEdit_TitleField], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Primary}"/>
                <Entry Text="{Binding Title}"
                       Placeholder="{Binding [FormEdit_TitlePlaceholder], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="14"
                       Margin="0,5,0,0"/>
            </StackLayout>

            <!-- Categoria e Status -->
            <StackLayout BackgroundColor="White"
                    Padding="15">
                <Grid ColumnDefinitions="*,*"
                        ColumnSpacing="10">
                    <StackLayout Grid.Column="0">
                        <Label Text="{Binding [FormEdit_Category], Source={x:Static services:LocalizationResourceManager.Instance}}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>
                        <Picker ItemsSource="{Binding Categories}"
                                SelectedIndex="{Binding CategoryId}"
                                ItemDisplayBinding="{Binding Name}"
                                FontSize="14"
                                Margin="0,5,0,0"/>
                    </StackLayout>

                    <StackLayout Grid.Column="1">
                        <Label Text="{Binding [FormEdit_Status], Source={x:Static services:LocalizationResourceManager.Instance}}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>
                        <Picker ItemsSource="{Binding StatusItems}"
                                SelectedIndex="{Binding StatusFormId}"
                                ItemDisplayBinding="{Binding Name}"
                                FontSize="14"
                                Margin="0,5,0,0"/>
                    </StackLayout>
                </Grid>
            </StackLayout>

            <!-- Pontuação Total -->
            <StackLayout BackgroundColor="White"
                    Padding="15">
                <Label Text="{Binding [FormEdit_Score], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Primary}"/>
                <Entry Text="{Binding TotalScore}"
                       Placeholder="0"
                       Keyboard="Numeric"
                       FontSize="14"
                       Margin="0,5,0,0"/>
                <Label Text="{Binding [FormEdit_ScoreHint], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="12"
                       TextColor="{StaticResource Gray600}"
                       Margin="0,5,0,0"/>
            </StackLayout>

            <!-- Configurações -->
            <StackLayout BackgroundColor="White"
                    Padding="15">
                <Label Text="{Binding [Posture_Settings], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Primary}"
                       Margin="0,0,0,10"/>

                <Grid ColumnDefinitions="Auto,*"
                        ColumnSpacing="10">
                    <Switch Grid.Column="0"
                            IsToggled="{Binding SequentialScript}"
                            VerticalOptions="Center"/>
                    <StackLayout Grid.Column="1"
                            VerticalOptions="Center">
                        <Label Text="{Binding [FormEdit_SequentialScript], Source={x:Static services:LocalizationResourceManager.Instance}}"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray900}"/>
                        <Label Text="{Binding [FormEdit_SequentialScriptHint], Source={x:Static services:LocalizationResourceManager.Instance}}"
                               FontSize="12"
                               TextColor="{StaticResource Gray600}"/>
                    </StackLayout>
                </Grid>
            </StackLayout>

            <!-- Informações de ID (apenas no modo de edição) -->
            <Border BackgroundColor="{StaticResource Gray100}"
                    Padding="20"
                    StrokeShape="RoundRectangle 10"
                    IsVisible="{Binding IsEditMode}">
            <StackLayout BackgroundColor="{StaticResource Gray100}"
                         Padding="15"
                         IsVisible="{Binding IsEditMode}">
                <Label Text="{Binding [FormEdit_SystemInfo], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray700}"
                       Margin="0,0,0,10"/>

                <Grid ColumnDefinitions="Auto,*"
                        RowDefinitions="Auto,Auto"
                        ColumnSpacing="10"
                        RowSpacing="5">
                    <Label Grid.Row="0"
                            Grid.Column="0"
                           Text="ID:"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Gray600}"/>
                    <Label Grid.Row="0"
                            Grid.Column="1"
                           Text="{Binding FormId}"
                           FontSize="12"
                           TextColor="{StaticResource Gray700}"/>
                </Grid>
            </StackLayout>
            </Border>

            <!-- Botão de Salvar -->
            <Button Text="{Binding IsEditMode, Converter={StaticResource EditModeToTextConverter}}"
                    Command="{Binding SaveCommand}"
                    BackgroundColor="{StaticResource Primary}"
                    TextColor="White"
                    FontSize="16"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Botões de ação secundária -->
            <Grid ColumnDefinitions="*,*,*"
                    ColumnSpacing="10">

                <!-- Botão Excluir (apenas no modo de edição) -->
                <Button Grid.Column="0"
                        Text="{Binding [FormEdit_Delete], Source={x:Static services:LocalizationResourceManager.Instance}}"
                        Command="{Binding DeleteCommand}"
                        BackgroundColor="{StaticResource Secondary}"
                        TextColor="{StaticResource Primary}"
                        FontSize="14"
                        HeightRequest="45"
                        IsVisible="{Binding CanDelete}"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"/>

                <!-- Botão Cancelar -->
                <Button Grid.Column="2"
                        Text="{Binding [Common_Cancel], Source={x:Static services:LocalizationResourceManager.Instance}}"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource Gray600}"
                        BorderColor="{StaticResource Gray300}"
                        BorderWidth="1"
                        FontSize="14"
                        HeightRequest="45"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"/>
            </Grid>

            <!-- Loading indicator -->
            <StackLayout IsVisible="{Binding IsLoading}"
                         VerticalOptions="Center"
                         HorizontalOptions="Center"
                         Padding="20">
                <ActivityIndicator IsRunning="{Binding IsLoading}"
                                   Color="{StaticResource Primary}"
                                   WidthRequest="40"
                                   HeightRequest="40"/>
                <Label Text="{Binding [Common_Processing], Source={x:Static services:LocalizationResourceManager.Instance}}"
                       FontSize="16"
                       TextColor="{StaticResource Primary}"
                       HorizontalOptions="Center"
                       Margin="0,10,0,0"/>
            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>